workflow: session-insights-dev
description: Development workflow for session-insights CLI tool with failure diagnosis

agents:
  - role: engineer
  - role: reviewer

states:
  start:
    type: initial
    auto_transition: engineering

  engineering:
    instructions: |
      Implement the assigned task for the session-insights CLI tool.
      
      Follow Python best practices:
      - Use Pydantic v2 for models
      - Click for CLI commands
      - pytest for testing
      - Type hints throughout
      
      For parsing tasks (e.g., vermas-parser):
      - Start with the simplest case first and add complexity incrementally
      - Write a failing test before implementing each parsing feature
      - If the parsing logic is complex, break it into smaller helper functions
      - Handle edge cases explicitly (empty input, malformed input, etc.)
      
      Run tests before signaling done:
      `uv run pytest tests/ -x -q`
      
      If tests fail, fix them before signaling.
      
      Signal "done" when implementation is complete and tests pass.
      Signal "blocked" if you encounter infrastructure issues or unsolvable dependencies.
    on_signal:
      done:
        from: engineer
        next: reviewing
      blocked:
        from: engineer
        next: blocked
    timeout:
      duration: 30m
      action: nudge

  reviewing:
    instructions: |
      Review the implementation for correctness and quality.
      
      Verification steps:
      1. Read all changed files
      2. Run full test suite with coverage
      3. Test CLI manually if applicable
      4. Check for edge cases and error handling
      
      For parsing implementations:
      - Verify edge cases are handled (empty, malformed, boundary conditions)
      - Check that error messages are helpful for debugging
      
      Signal "approved" if quality is acceptable.
      Signal "needs_revision" with specific feedback if changes needed.
    on_signal:
      approved:
        from: reviewer
        next: finalize
      needs_revision:
        from: reviewer
        next: engineering
    timeout:
      duration: 15m
      action: nudge

  blocked:
    type: terminal
    on_entry:
      - action: log
        message: Workflow blocked - engineer signaled infrastructure or dependency issue

  finalize:
    type: terminal
    on_entry:
      - action: commit
